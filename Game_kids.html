<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
<title>Game Kids</title>
<!-- ... CSS dan font seperti sebelumnya ... -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
<style>
/* (CSS seperti sebelumnya, tidak diubah demi ringkas) */
</style>
</head>
<body class="no-select">

<div id="splashScreen">
    <img src="icon.png" alt="Logo Game">
    <div id="splashText" style="color:#aaa; font-size:18px;margin-top:20px;">Memulai...</div>
</div>

<div id="mainMenuScreen" class="screen">
    <div class="menu-content">
        <div id="highScoreDisplay">Skor Tertinggi: 0</div>
        <button id="modeBtn" class="big-btn main-menu-btn needs-selection">Mode</button>
        <div id="modeSelectionDisplay" class="selection-display"></div>
        <button id="levelBtn" class="big-btn main-menu-btn needs-selection">Level</button>
        <div id="levelSelectionDisplay" class="selection-display"></div>
        <button id="startBtn" class="big-btn" disabled>Mulai</button>
    </div>
</div>
<div id="selectionScreen" class="screen">
    <div class="menu-content">
        <h2 id="selectionTitle">Pilih Mode</h2>
        <div id="selectionOptions" class="options-grid"></div>
        <button id="backToMainBtn" class="big-btn" style="background-color: #E74C3C; margin-top: 20px;">Kembali</button>
    </div>
</div>
<div id="gameScreen" class="screen">
    <header>
        <div class="stats">
            <span>Skor: <span id="score">0</span></span>
            <div id="livesContainer"></div>
        </div>
        <div class="controls">
            <button id="musicToggle" class="music-btn" title="Music On/Off">üéµ</button>
            <button id="backToMenu" class="btn">Kembali</button>
        </div>
    </header>
    <div id="gameArea">
        <canvas id="gameCanvas"></canvas>
        <canvas id="popCanvas"></canvas>
    </div>
    <div id="target" class="target">A</div>
</div>
<div id="dimOverlay" class="overlay"></div>
<div id="gameOverScreen" class="overlay">
    <div class="overlay-content">
        <h2 style="color: #E74C3C;">Game Over</h2>
        <p>Skor Akhir: <span id="finalScore">0</span></p>
        <p>Jawaban Benar: <span id="finalCorrect">0</span></p>
        <div class="overlay-buttons">
            <button id="ulangiBtn" class="big-btn">Ulangi</button>
            <button id="menuBtn" class="big-btn">Menu</button>
        </div>
    </div>
</div>
<!-- ... audio & copyright ... -->
<audio id="audio_opening" src="openinggame.wav" preload="auto"></audio>
<audio id="audio_bgm" src="latarmusic.mp3" preload="auto" loop></audio>
<audio id="audio_countdown" src="mulaigame.wav" preload="auto"></audio>
<audio id="audio_pop" src="pop.mp3" preload="auto"></audio>
<audio id="audio_button" src="tombol.mp3" preload="auto"></audio>
<audio id="audio_benar" src="tebakbenar.wav" preload="auto"></audio>
<audio id="audio_salah" src="tebaksalah.wav" preload="auto"></audio>
<audio id="audio_gameover" src="gameover.wav" preload="auto"></audio>
<audio id="audio_tangkaptarget" src="tangkaptarget.wav" preload="auto"></audio>
<audio id="audio_targetbaru" src="targetbaru.wav" preload="auto"></audio>

<script>
/* --- PATCH SPLASH ANTI-STUCK --- */
function hideSplashScreen() {
    var splash = document.getElementById('splashScreen');
    if (splash && splash.style.display !== "none") {
        splash.style.opacity = '0';
        setTimeout(function(){ splash.style.display = 'none'; }, 700);
    }
}
setTimeout(hideSplashScreen, 2000);
document.addEventListener('DOMContentLoaded', function() {
    var splash = document.getElementById('splashScreen');
    if (splash) {
        splash.addEventListener('click', hideSplashScreen);
        splash.addEventListener('touchstart', hideSplashScreen);
    }
});
window.addEventListener('error', hideSplashScreen);

/* --- LOGIKA TOMBOL DAN STATE UI --- */
document.addEventListener('DOMContentLoaded', function() {
    // State
    let mode = null, level = null, highScore = 0;

    // Tombol & elemen
    const modeBtn = document.getElementById('modeBtn');
    const levelBtn = document.getElementById('levelBtn');
    const startBtn = document.getElementById('startBtn');
    const ulangiBtn = document.getElementById('ulangiBtn');
    const menuBtn = document.getElementById('menuBtn');
    const backToMainBtn = document.getElementById('backToMainBtn');
    const backToMenuBtn = document.getElementById('backToMenu');
    const musicToggle = document.getElementById('musicToggle');
    const mainMenuScreen = document.getElementById('mainMenuScreen');
    const selectionScreen = document.getElementById('selectionScreen');
    const gameScreen = document.getElementById('gameScreen');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const modeSelectionDisplay = document.getElementById('modeSelectionDisplay');
    const levelSelectionDisplay = document.getElementById('levelSelectionDisplay');
    const selectionTitle = document.getElementById('selectionTitle');
    const selectionOptions = document.getElementById('selectionOptions');
    const highScoreEl = document.getElementById('highScoreDisplay');
    const scoreEl = document.getElementById('score');
    const livesContainer = document.getElementById('livesContainer');
    const finalScoreEl = document.getElementById('finalScore');
    const finalCorrectEl = document.getElementById('finalCorrect');
    const dimOverlay = document.getElementById('dimOverlay');

    // Cek tombol mulai
    function checkAndEnableStartButton() {
        startBtn.disabled = !(mode && level);
    }

    // Pilihan Mode & Level (populasi dinamis)
    function showSelectionScreen(type) {
        mainMenuScreen.classList.remove('active');
        selectionScreen.classList.add('active');
        selectionTitle.textContent = `Pilih ${type}`;
        selectionOptions.innerHTML = '';
        let options;
        if (type === 'Mode') {
            options = [ { text: 'Huruf', value: 'letters' }, { text: 'Angka', value: 'numbers' }, { text: 'Hewan', value: 'animals' }, { text: 'Hijaiyah', value: 'hijaiyah' }, { text: 'Mix', value: 'mix' } ];
        } else {
            options = Array.from({ length: 10 }, (_, i) => ({ text: i + 1, value: i + 1 }));
        }
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.textContent = opt.text;
            btn.onclick = function() {
                // Audio tombol jika ada
                let sfx = document.getElementById('audio_button'); if(sfx) {sfx.currentTime=0;sfx.play();}
                if (type === 'Mode') {
                    mode = opt.value;
                    modeSelectionDisplay.textContent = opt.text;
                    modeSelectionDisplay.classList.add('visible');
                    modeBtn.classList.remove('needs-selection');
                } else {
                    level = opt.value;
                    levelSelectionDisplay.textContent = `Level ${opt.text}`;
                    levelSelectionDisplay.classList.add('visible');
                    levelBtn.classList.remove('needs-selection');
                }
                selectionScreen.classList.remove('active');
                mainMenuScreen.classList.add('active');
                checkAndEnableStartButton();
            };
            selectionOptions.appendChild(btn);
        });
    }

    // Tombol Mode
    modeBtn.onclick = function() { showSelectionScreen('Mode'); };
    // Tombol Level
    levelBtn.onclick = function() { showSelectionScreen('Level'); };
    // Tombol Kembali dari Selection
    backToMainBtn.onclick = function() {
        selectionScreen.classList.remove('active');
        mainMenuScreen.classList.add('active');
    };

    // Tombol Mulai
    startBtn.onclick = function() {
        if (startBtn.disabled) return;
        // Audio tombol jika ada
        let sfx = document.getElementById('audio_button'); if(sfx) {sfx.currentTime=0;sfx.play();}
        mainMenuScreen.classList.remove('active');
        gameScreen.classList.add('active');
        // Reset skor dan game state (jika ada fungsi di game asli, panggil di sini)
        if(scoreEl) scoreEl.textContent = 0;
        if(livesContainer) livesContainer.innerHTML = '‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è';
    };

    // Tombol Kembali di Game
    backToMenuBtn.onclick = function() {
        // Audio tombol jika ada
        let sfx = document.getElementById('audio_button'); if(sfx) {sfx.currentTime=0;sfx.play();}
        gameScreen.classList.remove('active');
        mainMenuScreen.classList.add('active');
    };

    // Tombol Ulangi di Game Over
    ulangiBtn.onclick = function() {
        // Audio tombol jika ada
        let sfx = document.getElementById('audio_button'); if(sfx) {sfx.currentTime=0;sfx.play();}
        gameOverScreen.style.opacity = '0';
        setTimeout(function(){
            gameOverScreen.style.display = 'none';
            gameScreen.classList.add('active');
            // Reset skor dan nyawa (game state)
            if(scoreEl) scoreEl.textContent = 0;
            if(livesContainer) livesContainer.innerHTML = '‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è';
        }, 500);
    };

    // Tombol Menu di Game Over
    menuBtn.onclick = function() {
        // Audio tombol jika ada
        let sfx = document.getElementById('audio_button'); if(sfx) {sfx.currentTime=0;sfx.play();}
        gameOverScreen.style.opacity = '0';
        setTimeout(function(){
            gameOverScreen.style.display = 'none';
            mainMenuScreen.classList.add('active');
        }, 500);
    };

    // Tombol Music On/Off
    musicToggle.onclick = function() {
        musicToggle.classList.toggle("active");
        let bgm = document.getElementById('audio_bgm');
        if(musicToggle.classList.contains("active") && bgm) { bgm.play(); }
        else if(bgm) { bgm.pause(); }
    };

    // Saat game over dari game logic, tampilkan gameOverScreen
    window.triggerGameOver = function(finalScore, correctAnswers) {
        gameScreen.classList.remove('active');
        gameOverScreen.style.display = 'flex';
        setTimeout(()=> gameOverScreen.style.opacity = '1', 100);
        if(finalScoreEl) finalScoreEl.textContent = finalScore || 0;
        if(finalCorrectEl) finalCorrectEl.textContent = correctAnswers || 0;
    };

    // Skor tertinggi
    highScore = parseInt(localStorage.getItem('gameKidsHighScore') || '0', 10);
    highScoreEl.textContent = `Skor Tertinggi: ${highScore}`;

    // State awal
    mainMenuScreen.classList.add('active');
});
</script>

<div class="copyright-footer">
  <p>Copyright ¬© 2025 Imam M.A. All Rights Reserved.</p>
</div>
</body>
</html>
